# VSP_to_SU2
A pipeline for automated surface meshing from OpenVSP Geometry to SU2 CFD. 
Currently uses the CFD_MESH API from OpenVSP to generate surface mesh and use GMSH API to populate the fluid domain. 
## Dependencies
### OpenVSP API
The code is depend on OpenVSP Python API. Documentations can be found here: https://openvsp.org/api_docs/latest/
Unfortunately the current API does not allow symmetry plane splitting, and therefoer meshing the half-fluid domain with a big farfield will be either stupidly expensive or not watertight.
The current implementation therefore creates a full mesh (no symmetry boundary) of the vehicle.
A tutorial for how to build vsp python API is available at https://www.youtube.com/watch?v=3Pxw2kV99xU

### Gmsh API
The code currently uses Gmsh python API to populate the fluid domain and perform 3D mesh smoothing. 
1. install gmsh (download from official website https://gmsh.info/)
2. install gmsh python API  ``` pip install gmsh ```
   
## run_cfd_mesh.py
This function takes in the aircraft.vsp3 file and performs CFD_Mesh. the export is a stl bounding the fluid domain with boundary markers
to run the function ```run_cfd_mesh(vsp_file, output_mesh_file, minedge,maxedge, sym=False, farfield_scale= 2.0, farfield= False) ```
where ```vsp_file``` is the name of the .vsp3 file. 
      ```minedge ``` and ```maxedge``` are the mesh controls of the aircraft surface
      ```sym``` and ```farfield``` are the respective flags for generating half-mesh and generating farfield
      ```farfield_scale``` is the relative size of the farfield with respect to the aircraft size
The function will output a .stl file in the run directory
## STL_Gmesh.py
This function takes in the bounds of the CFD mesh and populate the volume cells. 
to run the function ```stl_to_su2(stl_path, su2_output_path) ```
where ```stl_path``` is the path to the stl file generated by ```run_cfd_mesh()```
      ```su2_output_path``` is the name of the exported .su2 mesh file
The function will output a .su2 file that can be fed to SU2_CFD
    and a boundary_marker.txt that documents the boundary names (neede for writing .cfg files)


## A simple Example 
An example aircraft is manually created in OpenVSP and saved to TestAircraft.vsp3
To obtain the surface mesh using VSP_CFD_MESH run 
``` py
import run_cfd_mesh as R
R.run_cfd_mesh("TestAircraft.vsp3", "TestAircraft.stl", 0.02,0.2, sym=False, farfield_scale= 50.0, farfield= True)
```
Then to populate the volume mesh, run
``` py
import STL_Gmesh as G
G.stl_to_su2("TestAircraft.stl", "TestAircraft.su2")
```
Then populate the cfg file for SU2_EULER using information in boundary_marker.txt (included in Run_AC.cfg)
Then run SU2_CFD Run_AC.cfg
The meshing part of this example is also included in VSPtoSU2

## Future Work
1. Currently the Gmsh does not offer boundary layer refinement capabilities, so the resultant mesh is only good for inviscid analysis
2. Switch over to cfMesh or snappyHexMesh for mesh genration. (I am still learning openFoam... this may take a while) these two toolbox offers really great volume meshing capabilities, so there's a chance of extending to viscous analysis. ~~since we are already meshing in openFoam environment, what's the point of switching over to SU2?~~
3. Add sources and local refinements in VSP_CFD_MESH
4. Wait for VSP to update their API to include ```symmetry plane splitting``` function. This function is already available in GUI version of OpenVSP, so maybe we can expect it in the API version soon?  
  
